<div class="repositoryUpdates">

	{if $updates.core}
		{$coreUpdate = $updates.core}
		<div class="coreUpdate">
			{Title "New core update available"}
			<table class="coreUpdateInfos">
				<tr>
					<th>New version</th>
					<td>{$coreUpdate.version}</td>
				</tr>
				<tr>
					<th>Your version</th>
					<td>{constant(TODOYU_VERSION)}</td>
				</tr>
				<tr>
					<th>Release date</th>
					<td>{dateFormat $coreUpdate.date_update date}</td>
				</tr>
			</table>
			<div class="installButton">
				{Button label="sysmanager.extension.repository.extension.moreDetails" class="installCoreUpdate"}
				{Button label="sysmanager.extension.repository.core.installUpdate" class="installCoreUpdate" onclick="Todoyu.Ext.sysmanager.Repository.showCoreUpdateDialog()"}
			</div>
			<div class="clear"></div>
		</div>
	{/if}


	<div class="extensionUpdates extListing">
		{Title "Extension updates"}

		{foreach $updates.extensions extUpdate}
			<div class="extension" id="repository-update-ext-{$extUpdate.ext_key}">

				<div class="main">
					<h5>
						<img src="{$extUpdate.icon}" width="32" height="32" border="0" />
						<div class="title">{$extUpdate.title} {$extUpdate.version.version}</div>
						<div class="author">From {$extUpdate.author.name}</div>
					</h5>
					<div class="description">{$extUpdate.version.version_information}</div>

					{if $extUpdate.version.dependencies}
						<div class="warning dependency">
							<p>There are unresolved dependencies</p>
							<ul>
								{foreach $extUpdate.version.dependencies dependency}
									<li id="{$extUpdate.ext_key}-dependency-{$dependency.ext_key}">{$dependency.title_short} {$dependency.version} ({$dependency.ext_key})</li>
								{/foreach}
							</ul>
						</div>
					{/if}
					{if $extUpdate.version.conflicts}
						<div class="warning conflicts">
							<p>There are unresolved conflicts</p>
							<ul>
								{foreach $extUpdate.version.conflicts conflict}
									<li id="{$extUpdate.ext_key}-conflict-{$conflict.ext_key}">{$conflict.title_short} ({$conflict.ext_key})</li>
								{/foreach}
							</ul>
						</div>
					{/if}

				</div>

				<div class="right">
					<div class="installed">Installed: {$extUpdate.installed}</div>
					<div class="version">New Version {$extUpdate.version.version}</div>
					<div class="state">STATE: {ExtensionStatus $extUpdate.version.state}</div>
					<div class="date">Date: {dateFormat $extUpdate.version.date_update date}</div>
				</div>

				<div class="bottom">
					<div class="add">
						{$hasDependencies = sizeof($extUpdate.version.dependencies)}
						{$hasConflicts = sizeof($extUpdate.version.conflicts)}
						{$preventInstall = $hasDependencies+$hasConflicts}
						{Button disabled=$preventInstall label="Update Extension" onclick="Todoyu.Ext.sysmanager.Repository.Update.showExtensionUpdateDialog('$extUpdate.ext_key')"}
					</div>
					<div class="details">
						{Button label="More infos" onclick="Todoyu.Ext.sysmanager.Repository.showExtensionInTER('$extUpdate.ter_link}')"}
					</div>
				</div>

				<div class="clear"></div>
			</div>
		{else}
			<p>No extension updates available</p>
		{/foreach}

		<div class="clear"></div>

	</div>

</div>

<script type="text/javascript">
Todoyu.Ext.sysmanager.Repository.Update.init();
</script>